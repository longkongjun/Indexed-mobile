# 技术调研 TODO

> 本文档用于收集“需要技术验证/调研”的问题清单。每个条目包含：背景、待确认点、调研输出物、决策门槛与结论记录区。

## TR-001：KMP 是否能桥接到 ArkTS/ArkUI（HarmonyOS）

- **背景**：规划中 HarmonyOS 采用 ArkTS + ArkUI 原生实现；希望尽可能复用 KMP（尤其是 `commonMain` 的业务逻辑/规则引擎），降低多端重复实现成本。
- **核心问题**：有没有可行方式把 KMP 产物“桥接”给 ArkTS/ArkUI 调用？可行路径分别是什么，工程化成本与长期维护风险如何？

### 待确认点（Questions）

- **Q1**：Kotlin/Native 在 HarmonyOS 目标上的可行性与成熟度（是否支持该目标、需要什么 toolchain、有哪些限制）。
- **Q2**：若走“Native 扩展”路线，ArkTS 与 Native 的标准桥接机制是什么（例如 NAPI/FFI/NDK 类能力），支持哪些数据类型与异步模型（Promise/Callback/Event）。
- **Q3**：KMP 的 `suspend` / Flow / 协程上下文，如何映射到 ArkTS 的异步范式；线程模型与调度边界如何定义。
- **Q4**：跨语言内存管理方案（对象生命周期、字符串/数组/二进制数据、零拷贝可能性、泄漏/崩溃风险）。
- **Q5**：错误与异常模型的统一（异常 -> 错误码/Result；堆栈与可观测性）。
- **Q6**：调试与可观测性（日志、崩溃符号、性能剖析、Trace）。
- **Q7**：构建与发布链路（鸿蒙工程集成 KMP 产物的方式；CI/CD；多架构产物；版本兼容与回滚）。
- **Q8**：替代方案评估：不桥接 KMP（鸿蒙原生重写）vs 通过“本地/自部署服务”以 API/IPC 复用逻辑。

### 候选路线（Hypotheses）

- **H1（优先验证）**：KMP `commonMain` → Kotlin/Native → 导出 C ABI → HarmonyOS Native 扩展（NAPI/FFI）→ ArkTS 调用。
- **H2**：KMP → Kotlin/JS 产物 → 以 JS 模块形式在 ArkTS 环境运行（需验证模块系统与运行时兼容性）。
- **H3**：将可复用逻辑下沉为本地守护进程/服务（Rust/Kotlin），ArkTS 通过 HTTP/gRPC/IPC 调用（弱化“桥接”，强化“服务化”）。

### 预期输出物（Deliverables）

- **D1**：一页式结论（可行/不可行/有条件可行），以及推荐路线。
- **D2**：最小可行原型（PoC）设计说明：调用链、数据类型、异步模型、错误处理。
- **D3**：工程化方案：目录结构、构建链路、CI 产物、版本策略。
- **D4**：风险清单与缓解策略（性能/稳定性/可维护性/生态风险）。

### 决策门槛（Go/No-Go）

- **G1**：能稳定完成 ArkTS → KMP 的同步与异步调用各 1 条关键路径（含错误返回）。
- **G2**：能跑通至少 1 个真实业务用例（例如“规则引擎执行一次整理任务”或“扫描任务编排一次”）。
- **G3**：构建链路可自动化（CI 可产出可集成制品），且调试可用（至少日志与崩溃定位）。

### 结论记录（Findings）

- **状态**：`TODO`
- **结论**：
  - （待填）
- **推荐路线**：
  - （待填）
- **备注**：
  - （待填）

