# 后台架构设计

依据 [产品立项说明](./00_project_overview.md)：**后台**面向管理者，用于**定义全部配置**（规则、插件、元数据等）。仅 Web 端提供后台能力。

---

## 模块说明

| 模块 | 职责 |
|------|------|
| **仪表盘** | 概览：资源统计、任务状态、系统健康 |
| **资源类型与配置** | 管理资源类型（含自定义类型）、默认规则与展示配置 |
| **规则配置** | 规则的新增/编辑/启用/禁用、优先级、作用范围 |
| **插件配置** | 插件安装/卸载、参数配置、启用状态 |
| **元数据源配置** | 元数据源（如 TMDB、豆瓣等）的启用与密钥配置 |
| **用户与权限** | 管理者账号、角色与权限（若多用户） |
| **系统设置** | 存储、队列、网络等基础配置的查看与修改 |
| **API 客户端** | 封装对服务端配置类 API 的调用 |
| **登录/鉴权** | 后台登录、Token 刷新、请求头注入 |

---

## 功能说明（能做什么）

以下按模块列出后台可执行的具体能力，供产品与开发对齐范围。

### 仪表盘
- 查看资源总数、按类型（漫画/影视/音乐/小说）分布、近期增长趋势。
- 查看扫描/刮削/整理任务的执行状态、进度、成功与失败数量。
- 查看系统健康：服务可用性、存储占用、队列积压等简要指标。
- 快速入口：跳转到资源管理、任务列表、各配置页。

### 资源类型与配置
- 查看与编辑内置资源类型（漫画、影视、音乐、小说）的展示名称、图标、排序。
- 新增/编辑/禁用自定义资源类型，配置类型标识、支持的文件扩展名、推荐目录结构说明。
- 为各类型配置默认刮削源、默认整理规则引用，供新入库资源使用。
- 配置列表与详情页的展示字段、筛选与排序选项（哪些字段可筛、可排）。

### 规则配置
- 新建规则：选择规则类型（命名、分类、移动、打标签等），配置匹配条件（路径、类型、标签）与动作参数（模板、目标目录等）。
- 编辑已有规则：修改条件与动作、启用/禁用、调整优先级（执行顺序）。
- 设置规则作用范围：全局、按资源类型、按库根目录。
- 测试规则：对示例路径或资源执行规则，预览结果后再保存。
- 查看规则执行日志或最近触发记录（若服务端提供）。

### 插件配置
- 查看已安装插件列表：名称、版本、状态（启用/禁用）、关联资源类型。
- 安装插件：上传插件包或从已配置的源安装，校验兼容性后启用。
- 卸载或禁用插件：禁用后该插件负责的资源类型相关能力不可用。
- 配置插件参数：每个插件暴露的配置项（如 API 地址、并发数、超时等）在后台表单中填写与保存。
- 查看插件日志或最近执行记录（若服务端提供）。

### 元数据源配置
- 查看已配置的元数据源列表：名称、类型（本地/远程）、启用状态、优先级。
- 新增/编辑元数据源：选择源类型（如 TMDB、豆瓣、MusicBrainz、MAL 等），填写 API Key、Base URL 等必要参数。
- 设置刮削顺序与优先级：同一资源类型下多个源的调用顺序与回退策略。
- 测试连通性：对指定源发起一次测试请求，确认密钥与网络可用。

### 用户与权限（若支持多用户）
- 管理后台账号：创建/编辑/禁用管理员账号，设置登录名与密码或 SSO 绑定。
- 分配角色与权限：定义角色（如超级管理员、只读管理员），将权限（如仅读配置、可改规则、可管用户）绑定到角色，再分配给用户。
- 查看登录与操作审计日志（若服务端记录并开放 API）。

### 系统设置
- 查看与修改库根目录、扫描间隔、并发数等存储与扫描相关配置。
- 查看与修改任务队列参数：扫描/刮削/整理任务的并发、重试次数、超时等。
- 查看与修改网络与代理配置（若服务端支持）。
- 查看服务端版本、运行时长、依赖健康状态；必要时触发缓存清理或重建索引（若 API 提供）。

### 登录与鉴权
- 使用账号密码或 SSO 登录后台，获取并刷新 Token。
- 所有请求自动携带 Token；Token 过期时引导重新登录或自动刷新。
- 未登录访问任意后台页时重定向到登录页。

---

## 技术选型

| 类别 | 选型 | 说明 |
|------|------|------|
| **框架** | React 或 Vue 3 | 单页应用，组件化与生态成熟 |
| **语言** | TypeScript | 类型安全、与后端 API 契约一致 |
| **状态管理** | Zustand / Pinia 或 React Query / VueUse | 轻量全局状态与服务端状态 |
| **请求** | Axios 或 fetch + 封装 | 统一鉴权、错误与 loading 处理 |
| **UI 组件库** | Ant Design / Element Plus 等 | 表单、表格、布局、权限组件 |
| **构建** | Vite | 快速冷启与 HMR |
| **部署** | 静态构建产物由 Nginx 或服务端网关托管 | 与 API 同域或配置 CORS |

---

## 与服务端的边界

- 后台**仅调用服务端提供的配置类 API**，不直接连数据库或消息队列。
- 规则、插件、元数据源、资源类型等配置的持久化与生效均在服务端完成；后台负责展示与编辑界面。

---

**最后更新**：2026-01-30 · 版本 1.0.0
